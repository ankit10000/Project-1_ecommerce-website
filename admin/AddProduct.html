<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="./image/adminicon.png" type="image/icon type">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>Manage Products</title>
    <style>
        .title {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container" style="position: fixed; z-index: 1; top: 0px;  width: 100%;">
        <div class="navbar">
            <div class="logo">
                <h1 style="color: aliceblue; text-decoration: underline;">Admin Panel</h1>
            </div>
            <nav>
                <ul id="MenuItems">
                    <li><a href="#alluser">All Users</a></li>
                    <li><a href="#allorder">All Orders</a></li>
                    <li><a href="#allcontact">All Contact</a></li>
                    <li><a href="#all">All Products</a></li>
                    <li><a href="#add">Add Product</a></li>
                    <li><a href="#update">Update Product</a></li>
                    <li><a href="#delete">Delete Product</a></li>
                    <li><a href="../login.html" onclick="confirmLogout()">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>
    <div class="main" style="margin-top: 100px;">
        <div id="alluser"></div>
        <div class="small-container login-page">
            <h2 class="title">All Users</h2>
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Contact</th>
                        <th>Password</th>
                        <th>Address</th>
                        <th>Active</th>
                        <th>Admin</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Product rows will be added here dynamically -->
                </tbody>
            </table>
            <div id="allorder"></div>
        </div>
    </div>
    <div class="main" style="margin-top: 100px;">
        <div class="small-container login-page">
            <h2 class="title">All Orders</h2>
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>User ID</th>
                        <th>Item</th>
                        <th>Address</th>
                        <th>Payment Method</th>
                        <th>Order Date</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Product rows will be added here dynamically -->
                </tbody>
            </table>
            <div id="allcontact"></div>
        </div>
    </div>
    <div class="main" style="margin-top: 100px;">
        <div class="small-container login-page">
            <h2 class="title">All Contact Us ! Feedback</h2>
            <table id="contactsTable">
                <thead>
                    <tr>
                        <th>Contact ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Message</th>
                        <th>Post Date</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Product rows will be added here dynamically -->
                </tbody>
            </table>
            <div id="all"></div>
        </div>
    </div>
    <div class="main" style="margin-top: 100px;">
        <div class="small-container login-page">
            <h2 class="title">All Products</h2>
            <table id="productsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Rating</th>
                        <th>Image URL</th>
                        <th>Image</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Product rows will be added here dynamically -->
                </tbody>
            </table>
            <div id="add"></div>
        </div>
    </div>
    <div class="main">
        <div class="small-container login-page">
            <div class="form-container1">
                <h2 class="title">Add Product</h2>
                <form id="addProduct">
                    <input type="text" id="productName" placeholder="Product Name" required>
                    <input type="text" id="productPrice" placeholder="Product Price" required>
                    <input type="text" id="productRating" placeholder="Product Rating" required>
                    <input type="text" id="productImage" placeholder="Product Image" required>
                    <button type="submit">Add Product</button>
                </form>
            </div>
            <div id="update"></div>
        </div>
    </div>

    <div class="main">
        <div class="small-container login-page">
            <div class="form-container1">
                <h2 class="title">Update Product</h2>
                <form id="updateProduct">
                    <input type="text" id="updateProductId" placeholder="Product ID" required>
                    <input type="text" id="updateProductName" placeholder="Product Name" required>
                    <input type="text" id="updateProductPrice" placeholder="Product Price" required>
                    <input type="text" id="updateProductRating" placeholder="Product Rating" required>
                    <input type="text" id="updateProductImage" placeholder="Product Image" required>
                    <button type="submit">Update Product</button>
                </form>
            </div>
            <div id="delete"></div>
        </div>
    </div>

    <div class="main">
        <div class="small-container login-page">
            <div class="form-container1">
                <h2 class="title">Delete Product</h2>
                <form id="deleteProduct">
                    <input type="text" id="deleteProductId" placeholder="Product ID" required>
                    <button type="submit">Delete Product</button>
                </form>
            </div>
        </div>
    </div>


    <!-- <script src="../javascript/script.js"></script> -->
    <script>
        function getCookieAdmin(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name == cookiePair[0].trim()) {
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            return null;
        }


        function setCookieAdmin(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }
        var token = getCookieAdmin('tokenadmin');
        if (token) {
            async function fetchOrders() {
                try {
                    const response = await fetch('https://reshopapi.onrender.com/api/ordersAdmin');
                    const orders = await response.json();
                    const ordersTableBody = document.getElementById('ordersTable').getElementsByTagName('tbody')[0];

                    ordersTableBody.innerHTML = '';

                    orders.forEach(order => {
                        const row = ordersTableBody.insertRow();
                        row.insertCell(0).innerText = order.order_id;
                        row.insertCell(1).innerText = order.user_id;
                        row.insertCell(2).innerText = order.items;
                        row.insertCell(3).innerHTML = order.address;
                        row.insertCell(4).innerHTML = order.payment_method;
                        row.insertCell(5).innerHTML = order.created_at;
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                    alert('An error occurred whinav ul lile fetching products.');
                }
            }

            async function fetchContacts() {
                try {
                    const response = await fetch('https://reshopapi.onrender.com/api/get-submit-contact');
                    const contacts = await response.json();
                    const contactsTableBody = document.getElementById('contactsTable').getElementsByTagName('tbody')[0];

                    contactsTableBody.innerHTML = '';

                    contacts.forEach(contact => {
                        const row = contactsTableBody.insertRow();
                        row.insertCell(0).innerText = contact.id;
                        row.insertCell(1).innerText = contact.name;
                        row.insertCell(2).innerText = contact.email;
                        row.insertCell(3).innerHTML = contact.message;
                        row.insertCell(4).innerHTML = contact.created_at;
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                    alert('An error occurred whinav ul lile fetching products.');
                }
            }

            async function fetchUsers() {
                try {
                    const response = await fetch('https://reshopapi.onrender.com/api/user');
                    const users = await response.json();
                    const usersTableBody = document.getElementById('usersTable').getElementsByTagName('tbody')[0];

                    usersTableBody.innerHTML = '';

                    users.forEach(user => {
                        const row = usersTableBody.insertRow();
                        row.insertCell(0).innerText = user.id;
                        row.insertCell(1).innerText = user.name;
                        row.insertCell(2).innerText = user.email;
                        row.insertCell(3).innerText = user.contact;
                        row.insertCell(4).innerHTML = `<input type="password" id="password" value="${user.password}" required disabled/>`;
                        row.insertCell(5).innerHTML = user.address;
                        row.insertCell(6).innerHTML = user.active ? 'Active' : 'Inactive';
                        row.insertCell(7).innerHTML = user.admin ? 'Active' : 'Inactive';
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                    alert('An error occurred while fetching products.');
                }
            }
            async function fetchProducts() {
                try {
                    const response = await fetch('https://reshopapi.onrender.com/api/product/getproducts');
                    const products = await response.json();
                    const productsTableBody = document.getElementById('productsTable').getElementsByTagName('tbody')[0];

                    productsTableBody.innerHTML = '';

                    products.forEach(product => {
                        const row = productsTableBody.insertRow();
                        row.insertCell(0).innerText = product.id;
                        row.insertCell(1).innerText = product.name;
                        row.insertCell(2).innerText = product.price;
                        row.insertCell(3).innerText = product.rating;
                        row.insertCell(4).innerHTML = product.image;
                        row.insertCell(5).innerHTML = `<img src="${product.image}" alt="${product.name}" width="50">`;
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                    alert('An error occurred while fetching products.');
                }
            }

            document.getElementById('addProduct').addEventListener('submit', async function (event) {
                event.preventDefault();

                const productName = document.getElementById('productName').value;
                const productPrice = document.getElementById('productPrice').value;
                const productRating = document.getElementById('productRating').value;
                const productImage = document.getElementById('productImage').value;

                const product = {
                    name: productName,
                    price: productPrice,
                    rating: productRating,
                    image: productImage
                };

                try {
                    const response = await fetch('https://reshopapi.onrender.com/api/product/addproduct', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(product)
                    });

                    if (response.ok) {
                        alert('Product added successfully!');
                        document.getElementById('addProduct').reset();
                        fetchProducts();
                    } else {
                        alert('Failed to add product.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while adding the product.');
                }
            });

            document.getElementById('updateProduct').addEventListener('submit', async function (event) {
                event.preventDefault();

                const productId = document.getElementById('updateProductId').value;
                const productName = document.getElementById('updateProductName').value;
                const productPrice = document.getElementById('updateProductPrice').value;
                const productRating = document.getElementById('updateProductRating').value;
                const productImage = document.getElementById('updateProductImage').value;

                const product = {
                    name: productName,
                    price: productPrice,
                    rating: productRating,
                    image: productImage
                };

                try {
                    const response = await fetch(`https://reshopapi.onrender.com/api/product/update/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(product)
                    });

                    if (response.ok) {
                        alert('Product updated successfully!');
                        document.getElementById('updateProduct').reset();
                        fetchProducts();
                    } else {
                        alert('Failed to update product.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while updating the product.');
                }
            });

            // Delete Product
            document.getElementById('deleteProduct').addEventListener('submit', async function (event) {
                event.preventDefault();

                const productId = document.getElementById('deleteProductId').value;

                try {
                    const response = await fetch(`https://reshopapi.onrender.com/api/product/delete/${productId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        alert('Product deleted successfully!');
                        document.getElementById('deleteProduct').reset();
                        fetchProducts(); // Refresh the products list
                    } else {
                        alert('Failed to delete product.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the product.');
                }
            });



            // Fetch products when the page loads
            document.addEventListener('DOMContentLoaded', fetchProducts);
            document.addEventListener('DOMContentLoaded', fetchUsers);
            document.addEventListener('DOMContentLoaded', fetchOrders);
            document.addEventListener('DOMContentLoaded', fetchContacts);
        } else if (!token) {
            window.location.href = '../login.html';
        }
        function confirmLogout() {
            try {
                const log = confirm('Are you sure you want to logout?');
                if (log == true) {
                    document.cookie = 'tokenadmin=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                }

            } catch (error) {
                console.error('Error:', error);
            }
        }

    </script>
</body>

</html>